<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script src="jquery.csv.js"></script>
		<script src="courses.js"></script>
		<link rel="stylesheet" type="text/css" href="main.css">
		<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">
		<meta charset="UTF-8">
	</head>

	<body>
		<div id="content">
			<div class="selected-courses" ondrop="handleDrop(event)" ondragover="handleDragover(event)">
				<div class="year-toggle-container" id="first-year-toggle">
					First year
					<div class="year-toggle"></div>
				</div>
				<div class="year-toggle-container" id="second-year-toggle">
					Second year
					<div class="year-toggle"></div>
				</div>
				<div class="year-container">
					<div class="year-toggle-container" id="third-year-toggle">
						Third year
						<div class="year-toggle"></div>
					</div>
					<div class="year-selected-courses" id="third-year-selected-courses">
						<center><div class='lp-disp' >LP1</div></center>
						<div class="period-selection" id="study-period-one">
						</div>
						<center><div class='lp-disp'>LP2</div></center>
						<div class="period-selection" id="study-period-two">
						</div>
						<center><div class='lp-disp'>LP3</div></center>
						<div class="period-selection" id="study-period-three">
						</div>
						<center><div class='lp-disp'>LP4</div></center>
						<div class="period-selection" id="study-period-four">
						</div>
					</div>
				</div>
			</div>
			<div id="course-list" ondrop="render()" ondragover="handleDragover(event)">
			</div>
		</div>


		<!--Scripts-->
		<script type="text/javascript">
			var selectedCourses = {yearOne:[], yearTwo:[], yearThree:[]};
			
			function render() {
				//Create visual representations of courses and display them
				var representations = "";

				data.sort(function(a,b){
						return (a.studyPeriod < b.studyPeriod) ? -1 : (a.studyPeriod > b.studyPeriod) ? 1 :
							((a.courseHolderCode < b.courseHolderCode) ? -1 : (a.courseHolderCode > b.courseHolderCode) ? 1 :
							((a.courseCode < b.courseCode) ? -1 : (a.courseCode > b.courseCode) ? 1 : 0));
				})

				representations += ("<center><div class='lp'>LP1</div></center><div class='period'>");

				for(i in data) {
					if(i > 0){
						if(data[i-1].studyPeriod != data[i].studyPeriod){
							representations += ("</div><center><div class='lp'" +
							 "'>" + data[i].studyPeriod +"</div></center><div class='period'>");
						}
					}
					representations += (
					 "<div class='course " + data[i].courseHolderCode
					 + "' id=" + data[i].courseCode +
					 " draggable='true' ondragstart='handleDragStart(event)'> <block class='course-code'>" +
					 data[i].courseCode + "</block><p class='course-name'>" +
					 data[i].courseName + "</p></div>");
				}
				representations += ("</div>");
				$('#course-list').html("");
				$('#course-list').append(representations);
				//End of creating visual representations and displaying them.
			}
		</script>


		<!--initial rendering of courses -->
		<script type="text/javascript">
			//Does on document ready
			$( document ).ready(function(){
				render();
			});
		</script>

		<script type="text/javascript">
			function handleDragStart(e) {
				e.dataTransfer.effectAllowed = 'move';
				e.dataTransfer.setData("text/plain", e.target.id);
				e.dataTransfer.opacity = 1;
    		e.target.style.visibility = "hidden";
			}

			function handleDragover(e) {
				e.preventDefault();
				e.dataTransfer.dropEffect = "move"
			}

			function handleDrop(e) {
				for(i in data) {
					if(data[i].courseCode == e.dataTransfer.getData("text")){
						selectedCourses.yearOne.push(data[i]);
						data.splice(i,1);
						render();
					}
				}

				var selectedCoursesForYear = selectedCourses.yearOne;
				for (var i = 1; i <= 4; i++) {
					var selectedCoursesForPeriod = [];
					var selectedCourseRepresentations = "";
					for(j in selectedCoursesForYear) {
						if(selectedCoursesForYear[j].studyPeriod == "LP"+i){
							selectedCoursesForPeriod.push(selectedCoursesForYear[j]);
							if(selectedCoursesForPeriod.length > 2){
								data.push(selectedCoursesForPeriod[0]);
								var a = selectedCoursesForPeriod.shift();
								for (k in selectedCoursesForYear) {
									if(selectedCoursesForYear[k] == a){
										selectedCoursesForYear.splice(k,1);
									}
								}

								console.log(selectedCoursesForYear.length);
								render();
							}
						}
					}
					for(j in selectedCoursesForPeriod) {
						selectedCourseRepresentations += ("<div class='selected-course " +
						selectedCoursesForPeriod[j].courseHolderCode + "' ><block class='ccp'>" +
						selectedCoursesForPeriod[j].courseCode + " </block><p class='cnp'>"+
						selectedCoursesForPeriod[j].courseName + "</p></div>");
					}
					$("#study-period-" + (i == 1 ? "one" : i == 2 ? "two" : i == 3 ? "three" : "four")).html(selectedCourseRepresentations);
				};
			}
		</script>

		<script>
			$('.year-toggle-container').click(function(event){
				switch (event.target.id) {
					case "third-year-toggle":
						$("#third-year-selected-courses").slideToggle();
						break;
					case "second-year-toggle":
						$("#second-year-selected-courses").slideToggle();
						break;
					case "second-year-toggle":
						$("#second-year-selected-courses").slideToggle();
						break;
				}
			})

		</script>
		<!--end of scripts-->
	</body>
</html>
