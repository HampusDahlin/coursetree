<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script src="jquery.csv.js"></script>
		<script src="courses.js"></script>
		<link rel="stylesheet" type="text/css" href="main.css">
		<link href="https://fonts.googleapis.com/css?family=Roboto+Slab" rel="stylesheet">

		<script type="text/javascript">
			//Does on document ready
			$( document ).ready(function() {
				var selectedCourses = [];

				//Create visual representations of courses and display them
				var representations = "";

				data.sort(function(a,b){
				    return (a.studyPeriod < b.studyPeriod) ? -1 : (a.studyPeriod > b.studyPeriod) ? 1 :
				    	((a.courseHolderCode < b.courseHolderCode) ? -1 : (a.courseHolderCode > b.courseHolderCode) ? 1 : 0);
				})

				representations += ("<center><div class='lp'>LP1</div></center><div class='period'>");

				for(i in data) {
					if(i > 0){
						if(data[i-1].studyPeriod != data[i].studyPeriod){
							representations += ("</div><center><div class='lp'>" + data[i].studyPeriod +"</div></center><div class='period'>");
						}
					}
					representations += (
					 "<div class='course " + data[i].courseHolderCode
					 + "' id=" + data[i].courseCode +
					 " draggable='true' ondragstart='handleDragStart(event)'> <block class='course-code'>" + data[i].courseCode +
					 "</block><p class='course-name'>" + data[i].courseName +
					 "</p></div>");
				}
				representations += ("</div>");

				$('#course-list').append(representations);

				//End of creating visual representations and displaying them.

				//On course click
				$(".course").click(function() {
					for(i in data) {
						if(data[i].courseCode == event.target.id){
							selectedCourses.push(data[i]);
						}
					}

					for (var i = 1; i <= 4; i++) {
						var selectedCoursesForPeriod = [];
						var selectedCourseRepresentations = "";
						for(j in selectedCourses) {
							if(selectedCourses[j].studyPeriod == "LP"+i){
								selectedCoursesForPeriod.push(selectedCourses[j]);
								if(selectedCoursesForPeriod.length > 2){
									selectedCoursesForPeriod.shift();
								}
							}
						}
						for(j in selectedCoursesForPeriod) {
							selectedCourseRepresentations += ("<div class='selected-course " + selectedCoursesForPeriod[j].courseHolderCode + " ><p id='course-code'>" + selectedCoursesForPeriod[j].courseCode + " </p><p id='course-name'>"+ selectedCoursesForPeriod[j].courseName + "</p></div>");
						}
						$("#study-period-" + (i == 1 ? "one" : i == 2 ? "two" : i == 3 ? "three" : "four")).html(selectedCourseRepresentations);
					};
				})
			})

			var dragSrcEl = null;
			
			function handleDragStart(e) {
				// Target (this) element is the source node.
				dragSrcEl = this;
				e.dataTransfer.effectAllowed = 'move';
				e.dataTransfer.setData("text/plain", e.target.id);
				console.log("lift-off");
			}

			function handleDragover(e) {
				e.preventDefault();
				// Set the dropEffect to move
				e.dataTransfer.dropEffect = "move"
			}

			function handleDrop(e) {
				console.log("landing");
			}
		</script>
		<meta charset="UTF-8">
	</head>
	<body>
		<div id="content">
			<div id="selected-courses" ondrop="handleDrop(event)" ondragover="handleDragover(event)">
				<center><div class='lp-disp'>LP1</div></center>
				<div class="period-selection" id="study-period-one">
				</div>
				<center><div class='lp-disp'>LP2</div></center>
				<div class="period-selection" id="study-period-two">
				</div>
				<center><div class='lp-disp'>LP3</div></center>
				<div class="period-selection" id="study-period-three">
				</div>
				<center><div class='lp-disp'>LP4</div></center>
				<div class="period-selection" id="study-period-four">
				</div>
			</div>
			<div id="course-list">
			</div>
		</div>
	</body>
</html>
